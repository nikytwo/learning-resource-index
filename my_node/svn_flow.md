
# svn 工作流程

## 前提

* 合理划分系统边界，系统在 svn 中独立为一个项目
	- 可单独演进
	- 可单独测试
	- 可单独部署
	- ......

* 每个项目下需包含以下3个目录
	- trunk : 主干（不负担开发）
	- branches : 开发分支（功能，bugfix）
	- tags : 稳定版（代码只读），用于发布 。


## 流程

### 功能开发(项目迭代)

每增加一个功能或迭代

1. 从最新 trunk 建立一个 branche 分支。（命名格式：dev-<功能英文名称>）
2. 开发并测试后提交代码至 svn。
3. 当该分支的所有功能点均完成后，将该分支合并（merge）至 trunk 主干上。
4. 对 trunk 主干上的功能进行测试。测试不通过的返回步骤 2，通过的跳至步骤 5。
5. 当 trunk 主干上的功能达到稳定状态时，对其进行上线操作：
	1. 将程序（pom.xml）中的版本号`<主版本号>.<次版本号>.<修订号>-SNAPSHOT`更改为`<主版本号>.<次版本号>.<修订号>`，并提交 svn。
	2. 打标签（tag）：从 trunk 中建立一个 tag 分支。(命名格式：v<主版本号>.<次版本号>.<修订号>)
	3. 程序（pom.xml）中的版本号的次版本号（或修订号）+1，并在版本号后添加`-SNAPSHOT`，然后提交 svn。
	4. 从 svn 中检出刚刚的 tag 分支，对该分支代码打包、上线。


### 修复缺陷(bug fix)

缺陷的修复分两种情况：

#### 对未上线的版本进行修复

 走功能开发流程

#### 对已经上线的版本进行修复

流程如下：

1. 从对应版本的 tag 中新建一个 branches 分支。（命名格式：hotfix-<bug名称>）
2. 在新建分支上进行 bug 的修复。
3. 当所有 bug 修复完成后，提交至 svn，并对其进行测试。测试不通过的返回步骤2，通过的跳转步骤 5.
4. 对该分支打标签，并进行上线操作：
	0. 将该分支的相关变更**合并至 trunk**。（避免下一功能发布时 bug 重现）
	1. 将程序（pom.xml）中的版本号的修订号+1，并提交 svn。
	2. 打标签（tag）：从该分支中建立一个新的 tag 分支。(命名格式：v<主版本号>.<次版本号>.<修订号>)
	3. 从 svn 中检出刚刚的 tag 分支，对该分支代码打包、上线。


## 另一种流程

世界上没有银弹，任何实际问题都要具体分析、解决。

![svn分支方案建议][svn_work_flow]


## 流程简化

每个项目都有适合自己的流程。

### 简化流程1

在可以确保 trunk 上的代码在上一次发布后没有经过更改的情况下，
可以直接从 trunk 中建立修复分支进行修复。

### 简化流程2

当项目只有 1-2 人开发时，可以直接在 trunk 上进行开发。

但，**任然打标签**。


## 其他

### git 工作流简介

分支模型：

![git-branch-model](http://www.xyula.com/assets/images/git-branch-model.png)

两个主分支：

* 产品分支： master
* 开发分支： develop

其他分支：

* 功能分支： feature/***
* 修复分支： hotfix/***
* 发布分支： release/***

关键操作：

* 每个功能均要建立一个功能分支，单独演进，完成后合并至 develp
* 修复分支必须从 master 中建立，完成后必须同时合并至 master 和 develop


### 什么是语义化版本

* [语义化版本](http://semver.org/lang/zh-CN/): 如何定义项目版本号


***

## 参考

* [SVN版本控制推荐使用方法](http://blog.csdn.net/flyfish1986/article/details/47131879)
* [svn代码版本管理总结](http://blog.csdn.net/xiaomu_fireant/article/details/6195622)


[svn_work_flow]: http://www.xyula.com/assets/images/svn_work_flow.jpg


