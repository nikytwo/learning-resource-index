
## 错误处理与异常

### 1. 抛出异常

* 不要返回**错误码**；

> 异常包括两种信息：异常消息、异常类型（用于异常处理程序）。

* 要通过抛出异常的方式来报告操作失败；

* 遇到严重问题应考虑终止进程；

* 避免在正常控制流程中使用异常；

> 好的框架应尽量让人编写不会引发异常的代码。（使用`Tester-Doer`或`Try-Parse`模式）


### 2. 选择合适的异常类型

#### 2.1. 错误分类：

* 使用错误： **不需要处理**，而是要修改代码。（如：`ArgumentNullException`,`NotSupportedException`...）
* 程序错误：应用程序**可以处理**
* 系统失败：应用程序**无法处理**

#### 2.2. 自定义异常的时机

* 程序错误（能够在代码中进行处理的），考虑创建并抛出自定义的异常；
* 错误是独一无二的（已有异常不能传达该错误，或使用已有异常导致错误情况模糊），应创建自定义的异常（优先考虑子类型）；

#### 2.3. 异常处理程序

* 捕获特定类型（已知道错误原因和处理办法）的异常；
* 不随便捕获异常，而是让其向上传递；（曝露不应该捕获的异常，以便测试发现并修复）
* 捕获异常后需重新抛出时，优先考虑抛出原异常（空的`throw`语句）；

#### 2.4. 异常的封装

除非底层的异常对高层**没有意义**，否则不要轻易封装异常。
若要封装，必须指定其内部异常。


### 3. 自定义异常的设计

* 避免继承层次深；
* 可序列化；
* 覆盖`ToString`来报告与安全性有关的信息；
* 确保只有可信赖的代码才能获得安全信息；
* 考虑自定义属性来让程序获得异常有关的额外信息；


